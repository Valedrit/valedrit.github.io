{% macro bb(nd,v,k,c) %}{% for nd in nd|split('['~v~']') %}{% if '[/'~v~']' in nd and loop.first==false %}{% if k and c %}<{{k}} {{c}}="{{v}}">{{ nd|split('[/'~v~']',2)|join('</'~k~'>')|raw }}{% else %}<{{v}}>{{ nd|split('[/'~v~']',2)|join('</'~v~'>')|raw }}{% endif %}{% else %}{% if loop.first==false %}[{{v}}]{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

 {% macro bb_code(nd,v,k,c) %}{% for nd in nd|split('['~v~']') %}{% if '[/'~v~']' in nd and loop.first==false %}{% if k and c %}<{{k}} {{c}}="{{v}}">{{ nd|split('[/'~v~']',2)|join('</'~k~'>')|raw }}{% else %}<div class="bbCodeBlock bbCodePHP"><div class="type">BlogBB CODE</div><div class="code" style="overflow-x: auto"><pre class="php" style="font-family: 'Helvetica Neue', Helvetica, 'Droid Sans', 'DroidSansRegular', Arial, sans-serif;"><ol>{{ nd|split('[/'~v~']',2)|first|replace({'@':"<@>",'<br />':"<br />",'\r\n':"<enter>"})|raw }}</ol></pre></div></div>
<textarea>{{ nd|split('[/'~v~']',2)|first|replace({'@':"<@>",'<br />':"",'\r\n':"<enter>"})|raw }}</textarea>{{ nd|split('[/'~v~']',2)|last|raw }}{% endif %}{% else %}{% if loop.first==false %}[{{v}}]{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

 {% macro bb_nick(nd,v) %}{% from 'func.twig' import account %}{% set nd=' '~nd|replace({'<br />': " <br />",'\r\n': " \r\n ",',':" ,",'.':" .",'\n': " \n ",'\r': " \r ",(' '~v):("  "~v)})|raw~' ' %}{% for nd in nd|split(' '~v) %}{% if get_data_count('user_'~nd|split(' ')|first)>0 and loop.first==false and '<' not in nd|split(' ')|first %}<a href="/account/{{nd|split(' ')|first|lower}}">{{account(nd|split(' ')|first|lower)}}</a> {{nd|split(' ',2)|last|raw }}{% else %}{% if loop.first==false %}{{v}}{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

 {% macro bb_link(nd,v) %}{% set nd=' '~nd|replace({'<br />': " <br />",'\r\n': " \r\n ",'\n': " \n ",'\r': " \r ",(' '~v):("  "~v)})|raw~' ' %}{% for nd in nd|split(' '~v) %}{% if '.' in nd and loop.first==false and '<' not in nd|split(' ')|first %}<a href="{{v}}{{ nd|split(' ')|first|replace({'[':"<[>",':': "<:>",'@':"<@>",'=':"<=>"})|raw }}">{{ v }}{{ nd|split(' ')|first|replace({'[':"<[>",':': "<:>",'@':"<@>",'=':"<=>"})|raw }}</a> {{nd|split(' ',2)|last|raw|raw }}{% else %} {% if loop.first==false %}{{v}}{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

 {% macro bb_url(nd,v,k) %}{% for nd in nd|split('['~v~'='~k) %}{% if '[/'~v~']' in nd and loop.first==false and '<' not in nd|split('[/'~v~']',2)|first|split(']',2)|first %}<a href="{{k}}{{ nd|split('[/'~v~']',2)|first|split(']',2)|first|replace({'[':"<[>",':': "<:>",'@':"<@>",'=':"<=>"})|raw }}">{{ nd|split('[/'~v~']',2)|first|split(']',2)|last|replace({'[':"<[>",':': "<:>",'@':"<@>",'=':"<=>"})|raw }}</a>{{ nd|split('[/'~v~']',2)|last|raw }}{% else %}{% if loop.first==false %}[{{v}}={{k}}{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

 {% macro bb_url2(nd,v,k) %}{% for nd in nd|split('['~v~']'~k) %}{% if '[/'~v~']' in nd and loop.first==false and '<' not in nd|split('[/'~v~']',2)|first %}<a href="{{k}}{{ nd|split('[/'~v~']',2)|first|replace({'[':"<[>",':': "<:>",'@':"<@>",'=':"<=>"})|raw }}">{{ nd|split('[/'~v~']',2)|first|replace({'[':"<[>",':': "<:>",'@':"<@>",'=':"<=>"})|raw }}</a>{{ nd|split('[/'~v~']',2)|last|raw }}{% else %}{% if loop.first==false %}[{{v}}]{{k}}{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

{% macro bb_img(nd,v,k) %}{% for nd in nd|split('['~v~']'~k) %}{% if '[/'~v~']' in nd and loop.first==false and '<' not in nd|split('[/'~v~']',2)|first %}<center><a href="{{k}}{{ nd|split('[/'~v~']',2)|first|replace({'[':"<[>",':': "<:>",'@':"<@>",'=':"<=>"})|raw }}"><img src="{{k}}{{ nd|split('[/'~v~']',2)|first|replace({'[':"<[>",':': "<:>",'@':"<@>",'=':"<=>"})|raw }}" style="padding: 8px; border: 2px dashed #FF4500;" /></a></center>{{ nd|split('[/'~v~']',2)|last|raw }}{% else %}{% if loop.first==false %}[{{v}}]{{k}}{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

 {% macro bb_quote(nd,v,k,c) %}
{% from 'func.twig' import get,login %}
{% set login=login()|trim %}
{% set user='user_'~login %}
{% for nd in nd|split('['~v~']') %}{% if '[/'~v~']' in nd and loop.first==false %}{% if k and c %}<{{k}} {{c}}="{{v}}">{{ nd|split('[/'~v~']',2)|join('</'~k~'>')|raw }}{% else %}{% if login and get(user,'css')=='mobile' %}<div class="quote">{% else %}<div class="bbcode_container"><div class="bbcode_quote"><div class="quote_container"><div class="bbcode_quote_container"></div>{% endif %}{{ nd|split('[/'~v~']',2)|first|replace({'[': "<[>",':': "<:>",'@':"<@>",'=':"<=>",'\r\n':"<enter>"})|raw }}{% if login and get(user,'css')=='mobile' %}</div>{% else %}</div></div></div>{% endif %}{{ nd|split('[/'~v~']',2)|last|raw }}{% endif %}{% else %}{% if loop.first==false %}[{{v}}]{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

 {% macro bb_nhac(nd,v,k,c) %}{% for nd in nd|split('['~v~']') %}{% if '[/'~v~']' in nd and loop.first==false %}{% if k and c %}<{{k}} {{c}}="{{v}}">{{ nd|split('[/'~v~']',2)|join('</'~k~'>')|raw }}{% else %}<i class="fa fa-volume-up"></i> Nghe nhạc:<br/><center><audio autoplay="autoplay" controls="controls" id="audio" title="Quà tặng âm nhạc"> <source type="audio/mpeg" src= "{{ nd|split('[/'~v~']',2)|first|replace({'[': "<[>",':': "<:>",'@':"<@>",'=':"<=>",'<br />': "",'\r\n':"<enter>"})|raw }}"></center>{{ nd|split('[/'~v~']',2)|last|raw }}{% endif %}{% else %}{% if loop.first==false %}[{{v}}]{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

{% macro bb_spoiler(nd,v,k,c) %}{% for nd in nd|split('['~v~']') %}{% if '[/'~v~']' in nd and loop.first==false %}{% if k and c %}<{{k}} {{c}}="{{v}}">{{ nd|split('[/'~v~']',2)|join('</'~k~'>')|raw }}{% else %}<div style="margin: 5px 5px 5px 5px;"><div class="smallfont" style="margin-bottom:2px"><b>BlogBB</b>: <input type="button" style="margin: 0px; padding: 0px; width: 45px; font-size: 10px;" onClick="if (this.parentNode.parentNode.getElementsByTagName('div')[1].getElementsByTagName('div')[0].style.display != '') { this.parentNode.parentNode.getElementsByTagName('div')[1].getElementsByTagName('div')[0].style.display = ''; this.innerText = ''; this.value = 'Hide'; } else { this.parentNode.parentNode.getElementsByTagName('div')[1].getElementsByTagName('div')[0].style.display = 'none'; this.innerText = ''; this.value = 'Show'; }" value="Show"></div><div style="border: 1px inset; background-color: whitesmoke; margin: 0px; padding: 2px;"><div style="display: none;">{{ nd|split('[/'~v~']',2)|first|replace({'[': "<[>",':': "<:>",'@':"<@>",'=':"<=>",'\r\n':"<enter>"})|raw }}</div></div></div>
{{ nd|split('[/'~v~']',2)|last|raw }}{% endif %}{% else %}{% if loop.first==false %}[{{v}}]{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

{% macro bb_src(nd,v,k) %}{% for nd in nd|split('['~v~']'~k) %}{% if '[/'~v~']' in nd and loop.first==false and '<' not in nd|split('[/'~v~']',2)|first %}<embed src="{{k}}{{ nd|split('[/'~v~']',2)|first|replace({'[':"<[>",':': "<:>",'@':"<@>",'=':"<=>"})|raw }}" />{{ nd|split('[/'~v~']',2)|last|raw }}{% else %}{% if loop.first==false %}[{{v}}]{{k}}{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}

 {% macro bb_log(nd,v,k,c) %}
{% from 'func.twig' import login %}
{% set login = login()|trim %}
{% for nd in nd|split('['~v~']') %}{% if '[/'~v~']' in nd and loop.first==false %}{% if k and c %}<{{k}} {{c}}="{{v}}">{{ nd|split('[/'~v~']',2)|join('</'~k~'>')|raw }}{% else %}
{% if login %}
{{ nd|split('[/'~v~']',2)|first|replace({'<br />':"<enter>",'\r\n':"<enter>"})|raw }}{{ nd|split('[/'~v~']',2)|last|raw }}
{% else %}
<div class="func">Sorry, bạn phải thành viên của diễn đàn mới có thể thấy nội dung này!</div>
{% endif %}
{% endif %}{% else %}{% if loop.first==false %}[{{v}}]{% endif %}{{nd|raw}}{% endif %}{% endfor %}{% endmacro %}